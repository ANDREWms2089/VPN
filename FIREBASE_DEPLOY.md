# üöÄ –î–µ–ø–ª–æ–π –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ Firebase Cloud Functions

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Node.js (–≤–µ—Ä—Å–∏—è 20 –∏–ª–∏ –≤—ã—à–µ)
2. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Firebase CLI: `npm install -g firebase-tools`
3. –ê–∫–∫–∞—É–Ω—Ç Google —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ Firebase Console

## üîß –®–∞–≥ 1: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Firebase

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
cd /Users/andrewvoevodin/StudioProjects/VPN_front
firebase login
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Google –∞–∫–∫–∞—É–Ω—Ç–µ.

## üîß –®–∞–≥ 2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase –ø—Ä–æ–µ–∫—Ç–∞

–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω –≤ Firebase Console:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://console.firebase.google.com/
2. –ù–∞–∂–º–∏—Ç–µ "Add project" (–∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
4. –ó–∞–ø–æ–º–Ω–∏—Ç–µ ID –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### –û–±–Ω–æ–≤–∏—Ç–µ .firebaserc

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.firebaserc` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ `vpn-front-app` –Ω–∞ ID –≤–∞—à–µ–≥–æ Firebase –ø—Ä–æ–µ–∫—Ç–∞:

```json
{
  "projects": {
    "default": "–í–ê–®-PROJECT-ID"
  }
}
```

## üîß –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd functions
npm install
cd ..
```

## üîß –®–∞–≥ 4: –î–µ–ø–ª–æ–π –Ω–∞ Firebase

```bash
firebase deploy --only functions
```

–≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –≤—ã —É–≤–∏–¥–∏—Ç–µ URL –≤–∞—à–µ–≥–æ API, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
Function URL (api): https://YOUR-REGION-YOUR-PROJECT.cloudfunctions.net/api
```

## üì° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤–∞—à API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:

```
https://YOUR-REGION-YOUR-PROJECT.cloudfunctions.net/api
```

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:

```bash
# Health check
curl https://YOUR-REGION-YOUR-PROJECT.cloudfunctions.net/api/health

# –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä–≤–µ—Ä—ã
curl https://YOUR-REGION-YOUR-PROJECT.cloudfunctions.net/api/api/servers

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ping
curl https://YOUR-REGION-YOUR-PROJECT.cloudfunctions.net/api/api/servers/nl-reality-1/ping
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –¥–≤–æ–π–Ω–æ–π `/api` - –ø–µ—Ä–≤—ã–π —ç—Ç–æ –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏, –≤—Ç–æ—Ä–æ–π —ç—Ç–æ –ø—É—Ç—å –≤ Express.

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ:

```bash
cd functions
npm install  # –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
cd ..
firebase deploy --only functions
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–û–±–Ω–æ–≤–∏—Ç–µ `lib/services/api_service.dart`:

```dart
static String get baseUrl {
  // –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Firebase URL
  return 'https://YOUR-REGION-YOUR-PROJECT.cloudfunctions.net/api/api';
}
```

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å Firebase

Firebase Functions –∏–º–µ–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier (Spark plan):
- 2 –º–∏–ª–ª–∏–æ–Ω–∞ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –≤ –º–µ—Å—è—Ü (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- 400,000 GB-—Å–µ–∫—É–Ω–¥ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- 200,000 GB-—Å–µ–∫—É–Ω–¥ –ø–∞–º—è—Ç–∏ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://firebase.google.com/pricing

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```bash
firebase logout
firebase login
```

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
1. –í—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç: `firebase use --add`
2. –í–∫–ª—é—á–µ–Ω billing –≤ Firebase Console (–¥–ª—è Blaze plan —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
3. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `cd functions && npm install`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
firebase functions:log
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –§–∞–π–ª—ã —Å–µ—Ä–≤–µ—Ä–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/tmp` –≤ Cloud Functions (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏)
- –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Firestore
- Cloud Functions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
2. –î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Firebase App Check –¥–ª—è –∑–∞—â–∏—Ç—ã API
